[[cloud-open-shift]]
= Open Shift
:icons: font

'''

This chapter explores how you can deploy Quarkus applications on OpenShift.

== Deploying on OpenShift

This section is going to deploy our microservices on OpenShift.
It is required to have access to an OpenShift cluster.

We recommend using a specific namespace to deploy your system.
In the following sections, we use the `quarkus-workshop` namespace.

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Execute the following commands to create the `quarkus-workshop` namespace.

[source, shell]
----
oc login
oc new-project quarkus-workshop \
  --description="This is the project for the Quarkus microservices workshop" \
  --display-name="Quarkus Workshop"

----

=== Deploying the infrastructure

The first thing to deploy is the required infrastructure:

* 3 PostgreSQL instances
* Kafka brokers (3 brokers with 3 Zookeeper to follow the recommended approach)

There are many ways to deploy this infrastructure.
Here, we are going to use two operators:

* PostgreSQL Operator by Dev4Ddevs.com
* Strimzi Apache Kafka Operator by Red Hat

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Find the available operators in the catalog using the following search
[source, shell]
----
$ oc get packagemanifests -n openshift-marketplace |egrep -i '(kafka|postgres)'
crunchy-postgres-operator                            Certified Operators   3d22h
postgresql                                           Community Operators   3d22h
postgresql-operator-dev4devs-com                     Community Operators   3d22h
crunchy-postgres-operator-rhmp                       Red Hat Marketplace   3d22h
cloud-native-postgresql                              Certified Operators   3d22h
strimzi-kafka-operator                               Community Operators   3d22h
----

The operators we want to install are the `postgresql-operator-dev4devs-com` and the `strimzi-kafka-operator` operators. The
operator's catalog source is identified in the second column. The following command provides the identifier of the operator's 
catalog source. Both operators use the same catalog source.

[source, shell]
----
$ oc get packagemanifests -n openshift-marketplace -o jsonpath='{.status.catalogSource}{"\n"}' strimzi-kafka-operator
community-operators
----

Next, the available subscription channels for the operators will be needed.

[source, shell]
----
$ oc get packagemanifest -o jsonpath='{range .status.channels[*]}{.name}{"\n"}{end}{"\n"}' -n community-operators strimzi-kafka-operator
stable
strimzi-0.19.x
strimzi-0.20.x
strimzi-0.21.x
strimzi-0.22.x

$ oc get packagemanifest -o jsonpath='{range .status.channels[*]}{.name}{"\n"}{end}{"\n"}' -n community-operators postgresql-operator-dev4devs-com
alpha
----

The `strimzi-0.22.x` and the `alpha` channels will be used.
To install an operator in a specific project, you need to create first an OperatorGroup in the target namespace. An OperatorGroup 
is an OLM resource that selects target namespaces in which to generate required RBAC access for all Operators in the same namespace 
as the OperatorGroup. 

[source, shell]
----
oc apply -f - <<EOF
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: quarkus-workshop
  namespace: quarkus-workshop
spec:
  targetNamespaces:
  - quarkus-workshop
EOF
----

Next, subscriptions will need to be created for the two operators.

[source, shell]
----
oc apply -f - <<EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: postgresql-operator-dev4devs-coml
  namespace: quarkus-workshop
spec:
  channel: "alpha"
  name: postgresql-operator-dev4devs-com
  source: community-operators
  sourceNamespace: openshift-marketplace
EOF
----

[source, shell]
----
oc apply -f - <<EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: strimzi-kafka-operator
  namespace: quarkus-workshop
spec:
  channel: "strimzi-0.22.x"
  name: strimzi-kafka-operator
  source: community-operators
  sourceNamespace: openshift-marketplace
EOF
----

Once installed, you will want to use the operators to setup the infrastructure. All the capabilities of the newly installed operators are described in the ClusterServiceVersion (CSV) created automatically by the Operator Lifecycle Manager (OLM).

[source, shell]
----
$ oc get csv
NAME                               DISPLAY                                VERSION   REPLACES   PHASE
postgresql-operator.v0.1.1         PostgreSQL Operator by Dev4Ddevs.com   0.1.1                Succeeded
strimzi-cluster-operator.v0.22.1   Strimzi                                0.22.1               Succeeded
----

With these operators installed, you can create the required infrastructure with the following custom resource definitions (CRDs):

[source, shell]
----
oc apply -f - <<EOF
apiVersion: postgresql.dev4devs.com/v1alpha1
kind: Database
metadata:
    name: heroes-database
    namespace: quarkus-workshop
spec:
    databaseCpu: 30m
    databaseCpuLimit: 60m
    databaseMemoryLimit: 512Mi
    databaseMemoryRequest: 128Mi
    databaseName: heroes-database
    databaseNameKeyEnvVar: POSTGRESQL_DATABASE
    databasePassword: superman
    databasePasswordKeyEnvVar: POSTGRESQL_PASSWORD
    databaseStorageRequest: 1Gi
    databaseUser: superman
    databaseUserKeyEnvVar: POSTGRESQL_USER
    image: centos/postgresql-96-centos7
    size: 1
EOF
----

[source, shell]
----
oc apply -f - <<EOF
apiVersion: postgresql.dev4devs.com/v1alpha1
kind: Database
metadata:
    name: villains-database
    namespace: quarkus-workshop
spec:
    databaseCpu: 30m
    databaseCpuLimit: 60m
    databaseMemoryLimit: 512Mi
    databaseMemoryRequest: 128Mi
    databaseName: villains-database
    databaseNameKeyEnvVar: POSTGRESQL_DATABASE
    databasePassword: superbad
    databasePasswordKeyEnvVar: POSTGRESQL_PASSWORD
    databaseStorageRequest: 1Gi
    databaseUser: superbad
    databaseUserKeyEnvVar: POSTGRESQL_USER
    image: centos/postgresql-96-centos7
    size: 1
EOF
----

[source, shell]
----
oc apply -f - <<EOF
apiVersion: postgresql.dev4devs.com/v1alpha1
kind: Database
metadata:
    name: fights-database
    namespace: quarkus-workshop
spec:
    databaseCpu: 30m
    databaseCpuLimit: 60m
    databaseMemoryLimit: 512Mi
    databaseMemoryRequest: 128Mi
    databaseName: fights-database
    databaseNameKeyEnvVar: POSTGRESQL_DATABASE
    databasePassword: superfight
    databasePasswordKeyEnvVar: POSTGRESQL_PASSWORD
    databaseStorageRequest: 1Gi
    databaseUser: superfight
    databaseUserKeyEnvVar: POSTGRESQL_USER
    image: centos/postgresql-96-centos7
    size: 1
EOF
----

For the Kafka broker and Zookeeper instances, create the following CRD:

[source, shell]
----
oc apply -f - <<EOF
apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-kafka
  namespace: quarkus-workshop
spec:
  kafka:
    version: 2.7.0
    replicas: 3
    listeners:
      plain: {}
      tls: {}
    config:
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 2
      log.message.format.version: '2.3'
    storage:
      type: ephemeral
  zookeeper:
    replicas: 3
    storage:
      type: ephemeral
  entityOperator:
    topicOperator: {}
    userOperator: {}
EOF
----

It's also recommended to create the Kafak topic using the following CRD:

[source, shell]
----
oc apply -f - <<EOF
apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: fights
  labels:
    strimzi.io/cluster: my-kafka
  namespace: quarkus-workshop
spec:
  partitions: 1
  replicas: 3
  config:
    retention.ms: 604800000
    segment.bytes: 1073741824
EOF
----

Once everything is created, you should have the following resources:

[source,shell]
----
$ oc get pods
NAME                                               READY   STATUS    RESTARTS   AGE
fights-database-6d55f6cfcd-n4rpk                   1/1     Running   0          4m1s
heroes-database-7dc4d6b9b9-hdrtk                   1/1     Running   0          12m
my-kafka-kafka-0                                   1/1     Running   0          29s
my-kafka-kafka-1                                   1/1     Running   0          29s
my-kafka-kafka-2                                   1/1     Running   0          29s
my-kafka-zookeeper-0                               1/1     Running   0          86s
my-kafka-zookeeper-1                               1/1     Running   0          86s
my-kafka-zookeeper-2                               1/1     Running   0          86s
postgresql-operator-695df466f5-bjnzd               1/1     Running   0          16m
strimzi-cluster-operator-v0.22.1-bd7d795c6-9zkqh   1/1     Running   0          15m
villains-database-5467588ddf-2lrdp                 1/1     Running   0          4m18s

----

=== Deploying the Hero & Villain microservices

Now that the infrastructure is in place, we can deploy our microservices.
Let's start with the hero and villain microservices.

For each, we need to override the data source URL.

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Create the Hero and Villain config maps with the following content:

[source, shell]
----
oc apply -f - <<EOF
apiVersion: v1
data:
    database: "jdbc:postgresql://heroes-database:5432/heroes-database"
kind: ConfigMap
metadata:
    name: hero-config
EOF
----

[source, shell]
----
oc apply -f - <<EOF
apiVersion: v1
data:
    database: "jdbc:postgresql://villains-database:5432/villains-database"
kind: ConfigMap
metadata:
    name: villain-config
EOF
----

Once the config maps are created, we can deploy the microservices.

The microservices will need to have the OpenShift extension added to the 'pom.xml'.

[source, shell]
----
$ cd superheros
$ cd rest-hero
$ ./mvnw quarkus:add-extension -Dextensions="openshift"
$ cd ../rest-villain
$ ./mvnw quarkus:add-extension -Dextensions="openshift"
$ cd ..

----
icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Update the hero microservice application.properties with the following content:

[source,yaml]
----
include::{github-raw}/super-heroes/rest-hero/src/main/resources/application.properties[tag=adocPort]

include::{github-raw}/super-heroes/rest-hero/src/main/resources/application.properties[tag=adocOCP]

include::{github-raw}/super-heroes/rest-hero/src/main/resources/application.properties[tag=adocOCPJDK]

include::{github-raw}/super-heroes/rest-hero/src/main/resources/application.properties[tag=adocOCPRoute]

include::{github-raw}/super-heroes/rest-hero/src/main/resources/application.properties[tag=adocOCPConfigMap]

----

These changes do the following:

1. Point to the JDK container image to use for the microservice
2. Expose an OCP route for the microservice
3. Use a ConfigMap for container environment variables to override the JDBC URL to be used
4. Set up the ports to be used by the service by using a Quarkus Profile

Update the villain microservice application.properties with the following content:

[source,yaml]
----
include::{github-raw}/super-heroes/rest-villain/src/main/resources/application.properties[tag=adocPort]

include::{github-raw}/super-heroes/rest-villain/src/main/resources/application.properties[tag=adocOCP]

include::{github-raw}/super-heroes/rest-villain/src/main/resources/application.properties[tag=adocOCPJDK]

include::{github-raw}/super-heroes/rest-villain/src/main/resources/application.properties[tag=adocOCPRoute]

include::{github-raw}/super-heroes/rest-villain/src/main/resources/application.properties[tag=adocOCPConfigMap]

----

Then, deploy the microservices with:

[source,shell]
----
$ oc login
$ oc project quarkus-workshop
$ cd rest-hero
$ ./mvnw clean package -Dquarkus.kubernetes.deploy=true -Dquarkus.profile=prod
$ cd ../rest-villain
$ ./mvnw clean package -Dquarkus.kubernetes.deploy=true -Dquarkus.profile=prod
----

=== Deploying the Fight microservice

Follow the same approach for the fight microservice.
Note that there are more properties to configure from the config map:

* the location of the hero and villain microservice
* the location of the Kafka broker.

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

[source, shell]
----
oc apply -f - <<EOF
apiVersion: v1
data:
    database: "jdbc:postgresql://fights-database:5432/fights-database"
    rest-hero: "http://rest-hero:8080"
    rest-villain: "http://rest-villain:8080"
    kafka: "my-kafka-kafka-bootstrap:9092"
kind: ConfigMap
metadata:
    name: fight-config
EOF
----

Once the config map is created, we can deploy the microservice.

The microservice will need to have the OpenShift extension added to the 'pom.xml'.

[source, shell]
----
$ cd superheros
$ cd rest-fight
$ ./mvnw quarkus:add-extension -Dextensions="openshift"

----

Update the fight microservice application.properties with the following content:

[source,yaml]
----
include::{github-raw}/super-heroes/rest-fight/src/main/resources/application.properties[tag=adocPort]

include::{github-raw}/super-heroes/rest-fight/src/main/resources/application.properties[tag=adocOCP]

include::{github-raw}/super-heroes/rest-fight/src/main/resources/application.properties[tag=adocOCPJDK]

include::{github-raw}/super-heroes/rest-fight/src/main/resources/application.properties[tag=adocOCPRoute]

include::{github-raw}/super-heroes/rest-fight/src/main/resources/application.properties[tag=adocOCPConfigMap]

----

These changes do the following:

1. Point to the JDK container image to use for the microservice
2. Expose an OCP route for the microservice
3. Use a ConfigMap for container environment variables to override the JDBC URL to be used
4. Set up the ports to be used by the service

Then, deploy the microservices with:

[source,shell]
----
$ oc login
$ oc project quarkus-workshop
$ cd rest-fight
$ ./mvnw clean package -Dquarkus.kubernetes.deploy=true  -Dquarkus.profile=prod
----

=== Verifing the deployment

The following steps will verify the microservices have been deployed properly.

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

[source,shell]
----
$ oc get is   
NAME               IMAGE REPOSITORY                                                                 TAGS                                               UPDATED
openjdk-11-rhel7   registry.access.redhat.com/openjdk/openjdk-11-rhel7                              1.0,1.0-11,1.0-12,1.0-12.1553790004 + 23 more...   2 days ago
rest-fight         image-registry.openshift-image-registry.svc:5000/quarkus-workshop/rest-fight     01                                                 About a minute ago
rest-hero          image-registry.openshift-image-registry.svc:5000/quarkus-workshop/rest-hero      1.0.0-SNAPSHOT                                     10 minutes ago
rest-villain       image-registry.openshift-image-registry.svc:5000/quarkus-workshop/rest-villain   1.0.0-SNAPSHOT                                     6 minutes ago

$ oc get dc
NAME           REVISION   DESIRED   CURRENT   TRIGGERED BY
rest-fight     2          1         1         image(rest-fight:01)
rest-hero      8          1         1         image(rest-hero:1.0.0-SNAPSHOT)
rest-villain   5          1         1         image(rest-villain:1.0.0-SNAPSHOT)

$  oc get deploy
NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
fights-database                    1/1     1            1           2d19h
heroes-database                    1/1     1            1           2d19h
my-kafka-entity-operator           1/1     1            1           2d19h
postgresql-operator                1/1     1            1           2d19h
strimzi-cluster-operator-v0.22.1   1/1     1            1           2d19h
villains-database                  1/1     1            1           2d19h

$ oc get pod
NAME                                               READY   STATUS      RESTARTS   AGE
fights-database-6d55f6cfcd-tt9sb                   1/1     Running     0          2d19h
heroes-database-7dc4d6b9b9-gt7mg                   1/1     Running     0          2d19h
my-kafka-entity-operator-f5994658b-2px27           3/3     Running     0          2d19h
my-kafka-kafka-0                                   1/1     Running     0          2d19h
my-kafka-kafka-1                                   1/1     Running     0          2d19h
my-kafka-kafka-2                                   1/1     Running     0          2d19h
my-kafka-zookeeper-0                               1/1     Running     0          2d19h
my-kafka-zookeeper-1                               1/1     Running     0          2d19h
my-kafka-zookeeper-2                               1/1     Running     0          2d19h
postgresql-operator-695df466f5-4vfs5               1/1     Running     0          2d19h
rest-fight-1-build                                 0/1     Completed   0          7m55s
rest-fight-1-deploy                                0/1     Completed   0          44h
rest-fight-2-deploy                                0/1     Completed   0          4m13s
rest-fight-2-zl564                                 1/1     Running     0          4m9s
rest-hero-1-build                                  0/1     Completed   0          15m
rest-hero-8-cdstr                                  1/1     Running     0          12m
rest-hero-8-deploy                                 0/1     Completed   0          12m
rest-villain-1-build                               0/1     Completed   0          12m
rest-villain-5-deploy                              0/1     Completed   0          8m53s
rest-villain-5-kl5bf                               1/1     Running     0          8m49s
strimzi-cluster-operator-v0.22.1-bd7d795c6-4nr5f   1/1     Running     0          2d19h
villains-database-5467588ddf-4zmvs                 1/1     Running     0          2d19h

$ oc get svc
NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
fights-database               ClusterIP   172.21.153.42    <none>        5432/TCP                     2d19h
heroes-database               ClusterIP   172.21.119.56    <none>        5432/TCP                     2d19h
my-kafka-kafka-bootstrap      ClusterIP   172.21.223.255   <none>        9091/TCP,9092/TCP,9093/TCP   2d19h
my-kafka-kafka-brokers        ClusterIP   None             <none>        9091/TCP,9092/TCP,9093/TCP   2d19h
my-kafka-zookeeper-client     ClusterIP   172.21.18.11     <none>        2181/TCP                     2d19h
my-kafka-zookeeper-nodes      ClusterIP   None             <none>        2181/TCP,2888/TCP,3888/TCP   2d19h
postgresql-operator-metrics   ClusterIP   172.21.176.92    <none>        8383/TCP,8686/TCP            2d19h
rest-fight                    ClusterIP   172.21.131.137   <none>        8080/TCP                     44h
rest-hero                     ClusterIP   172.21.226.159   <none>        8080/TCP                     2d4h
rest-villain                  ClusterIP   172.21.134.94    <none>        8080/TCP                     2d4h
villains-database             ClusterIP   172.21.117.96    <none>        5432/TCP                     2d19h


$ oc get route
NAME           HOST/PORT                                                                                                              PATH   SERVICES       PORT   TERMINATION   WILDCARD
rest-fight     rest-fight-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud     /      rest-fight     8080                 None
rest-hero      rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud      /      rest-hero      8080                 None
rest-villain   rest-villain-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud   /      rest-villain   8080                 None

----

=== Verifying the microservices
The following steps will verify the microservices are operating correctly. At this point, no data has been loaded into the databases.

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Verify the basic API is working for each microservice.
[source,shell]
----
$ curl http://rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/api/heroes
[]%                                                                                                 

$ curl http://rest-villain-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/api/villains
[]%  

$ curl http://rest-fight-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/api/fights
[]% 
----

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Verify the health, readiness and liveliness APIs are working for each microservice.

[source,shell]
----
$ curl http://rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health
{
    "status": "UP",
    "checks": [
        {
            "name": "Ping Hero REST Endpoint",
            "status": "UP"
        },
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "Hero Datasource connection health check",
            "status": "UP",
            "data": {
                "Number of heroes in the database": 0
            }
        }
    ]
}% 

$  curl http://rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/ready

{
    "status": "UP",
    "checks": [
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "Hero Datasource connection health check",
            "status": "UP",
            "data": {
                "Number of heroes in the database": 0
            }
        }
    ]
}%                                                                                     

$ curl http://rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/live

{
    "status": "UP",
    "checks": [
        {
            "name": "Ping Hero REST Endpoint",
            "status": "UP"
        }
    ]
}%                                                                                           

$ curl http://rest-villain-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health    

{
    "status": "UP",
    "checks": [
        {
            "name": "Ping Villain REST Endpoint",
            "status": "UP"
        },
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "Villain health check",
            "status": "UP",
            "data": {
                "rows": 0
            }
        }
    ]
}%                                                                                                                                                                                                      
$ curl http://rest-villain-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/ready

{
    "status": "UP",
    "checks": [
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "Villain health check",
            "status": "UP",
            "data": {
                "rows": 0
            }
        }
    ]
}%                                                                                                                                                                                                      
$ curl http://rest-villain-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/live

{
    "status": "UP",
    "checks": [
        {
            "name": "Ping Villain REST Endpoint",
            "status": "UP"
        }
    ]
}%                                                                                                       

$ curl http://rest-fight-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health     

{
    "status": "UP",
    "checks": [
        {
            "name": "SmallRye Reactive Messaging - liveness check",
            "status": "UP",
            "data": {
                "fights": "[OK]"
            }
        },
        {
            "name": "Ping Fight REST Endpoint",
            "status": "UP"
        },
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "SmallRye Reactive Messaging - readiness check",
            "status": "UP",
            "data": {
                "fights": "[OK]"
            }
        },
        {
            "name": "Fight health check",
            "status": "UP",
            "data": {
                "rows": 0
            }
        }
    ]
}%                                                                                                                                                                                                      
$ curl http://rest-fight-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/ready

{
    "status": "UP",
    "checks": [
        {
            "name": "Database connections health check",
            "status": "UP"
        },
        {
            "name": "SmallRye Reactive Messaging - readiness check",
            "status": "UP",
            "data": {
                "fights": "[OK]"
            }
        },
        {
            "name": "Fight health check",
            "status": "UP",
            "data": {
                "rows": 0
            }
        }
    ]
}%                                                                                                                                                                                                      
$ curl http://rest-fight-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/health/live

{
    "status": "UP",
    "checks": [
        {
            "name": "SmallRye Reactive Messaging - liveness check",
            "status": "UP",
            "data": {
                "fights": "[OK]"
            }
        },
        {
            "name": "Ping Fight REST Endpoint",
            "status": "UP"
        }
    ]
}%                                                                                   
----

icon:hand-o-right[role="red", size=2x] [red big]#Call to action#

Verify the metrics are beinbg collected for the Heros microservice. 

[source,shell]
----
% curl http://rest-hero-quarkus-workshop.cnt-cluster2-d397fcc2ee1796ae5b779b59baaa6ea4-0000.us-south.containers.appdomain.cloud/q/metrics/application
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countCreateHero_total Counts how many times the createHero method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countCreateHero_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countCreateHero_total 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countDeleteHero_total Counts how many times the deleteHero method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countDeleteHero_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countDeleteHero_total 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetAllHeroes_total Counts how many times the getAllHeroes method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetAllHeroes_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetAllHeroes_total 2.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetHero_total Counts how many times the getHero method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetHero_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetHero_total 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetRandomHero_total Counts how many times the getRandomHero method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetRandomHero_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countGetRandomHero_total 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_countUpdateHero_total Counts how many times the updateHero method has been invoked
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_countUpdateHero_total counter
application_io_quarkus_workshop_superheroes_hero_HeroResource_countUpdateHero_total 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_one_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_five_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_fifteen_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_min_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_max_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_mean_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_stddev_seconds 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds Times how long it takes to invoke the createHero method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds_count 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.5"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.75"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.95"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.98"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.99"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeCreateHero_seconds{quantile="0.999"} 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_one_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_five_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_fifteen_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_min_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_max_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_mean_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_stddev_seconds 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds Times how long it takes to invoke the deleteHero method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds_count 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.5"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.75"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.95"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.98"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.99"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeDeleteHero_seconds{quantile="0.999"} 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_rate_per_second 6.139885287530821E-4
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_one_min_rate_per_second 1.1577622905086166E-10
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_five_min_rate_per_second 1.3506479718232095E-4
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_fifteen_min_rate_per_second 6.056853996184428E-4
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_min_seconds 0.002720237
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_max_seconds 0.009426213
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_mean_seconds 0.005500504009127468
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_stddev_seconds 0.003303712940731683
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds Times how long it takes to invoke the getAllHeroes method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds_count 2.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.5"} 0.002720237
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.75"} 0.009426213
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.95"} 0.009426213
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.98"} 0.009426213
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.99"} 0.009426213
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetAllHeroes_seconds{quantile="0.999"} 0.009426213
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_one_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_five_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_fifteen_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_min_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_max_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_mean_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_stddev_seconds 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds Times how long it takes to invoke the getHero method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds_count 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.5"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.75"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.95"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.98"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.99"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetHero_seconds{quantile="0.999"} 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_one_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_five_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_fifteen_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_min_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_max_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_mean_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_stddev_seconds 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds Times how long it takes to invoke the getRandomHero method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds_count 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.5"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.75"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.95"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.98"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.99"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeGetRandomHero_seconds{quantile="0.999"} 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_one_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_one_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_five_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_five_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_fifteen_min_rate_per_second gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_fifteen_min_rate_per_second 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_min_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_min_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_max_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_max_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_mean_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_mean_seconds 0.0
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_stddev_seconds gauge
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_stddev_seconds 0.0
# HELP application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds Times how long it takes to invoke the updateHero method
# TYPE application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds summary
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds_count 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.5"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.75"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.95"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.98"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.99"} 0.0
application_io_quarkus_workshop_superheroes_hero_HeroResource_timeUpdateHero_seconds{quantile="0.999"} 0.0
----

Similar commands may be used to check the Villains and Fights microservices.

=== Loading data into the microservices

TBD

=== The finish line
Once everything is configured and deployed, your system is now running on Kubernetes.